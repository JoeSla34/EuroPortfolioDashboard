<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live Euro + Crypto Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
h1 { text-align: center; }
table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
th { background-color: #f2f2f2; }
canvas { max-width: 100%; margin-bottom: 50px; }
</style>
</head>
<body>

<h1>Live Euro + Crypto Dashboard</h1>

<table id="priceTable">
  <thead>
    <tr>
      <th>Pair</th>
      <th>Price</th>
    </tr>
  </thead>
  <tbody>
    <tr><td>EUR/USD</td><td id="eurusd">-</td></tr>
    <tr><td>EUR/GBP</td><td id="eurgbp">-</td></tr>
    <tr><td>EUR/JPY</td><td id="eurjpy">-</td></tr>
    <tr><td>BTC/EUR</td><td id="btceur">-</td></tr>
    <tr><td>ETH/EUR</td><td id="etheur">-</td></tr>
  </tbody>
</table>

<canvas id="chartCrypto" height="100"></canvas>
<canvas id="chartFiat" height="100"></canvas>

<script>
// Update interval in milliseconds
const interval = 60 * 1000; // 1 minute

// Fetch forex rates from Frankfurter
async function fetchForex() {
  const res = await fetch('https://api.frankfurter.app/latest?from=EUR&to=USD,GBP,JPY');
  const data = await res.json();
  return data.rates;
}

// Fetch crypto prices from CoinCap
async function fetchCrypto() {
  const res = await fetch('https://api.coincap.io/v2/assets?ids=bitcoin,ethereum');
  const data = await res.json();
  return {
    BTC: parseFloat(data.data[0].priceUsd) / parseFloat(await getEURUSD()), // convert USD→EUR
    ETH: parseFloat(data.data[1].priceUsd) / parseFloat(await getEURUSD())
  };
}

// Get EUR→USD rate (needed to convert CoinCap USD prices)
async function getEURUSD() {
  const res = await fetch('https://api.frankfurter.app/latest?from=EUR&to=USD');
  const data = await res.json();
  return data.rates.USD;
}

// Update dashboard
let cryptoHistory = {BTC: [], ETH: []};
let fiatHistory = {EURUSD: [], EURGBP: [], EURJPY: []};

async function updateDashboard() {
  const forex = await fetchForex();
  const crypto = await fetchCrypto();

  // Update table
  document.getElementById('eurusd').innerText = forex.USD.toFixed(4);
  document.getElementById('eurgbp').innerText = forex.GBP.toFixed(4);
  document.getElementById('eurjpy').innerText = forex.JPY.toFixed(2);
  document.getElementById('btceur').innerText = crypto.BTC.toFixed(2);
  document.getElementById('etheur').innerText = crypto.ETH.toFixed(2);

  // Store history for charts
  cryptoHistory.BTC.push(crypto.BTC);
  cryptoHistory.ETH.push(crypto.ETH);
  fiatHistory.EURUSD.push(forex.USD);
  fiatHistory.EURGBP.push(forex.GBP);
  fiatHistory.EURJPY.push(forex.JPY);

  const labels = cryptoHistory.BTC.map((_,i)=> i+1);

  // Update Crypto Chart
  new Chart(document.getElementById('chartCrypto').getContext('2d'), {
    type:'line',
    data:{
      labels,
      datasets:[
        {label:'BTC/EUR', data:cryptoHistory.BTC, borderColor:'orange', fill:false},
        {label:'ETH/EUR', data:cryptoHistory.ETH, borderColor:'purple', fill:false}
      ]
    },
    options:{responsive:true, plugins:{legend:{position:'top'}}}
  });

  // Update Forex Chart
  new Chart(document.getElementById('chartFiat').getContext('2d'), {
    type:'line',
    data:{
      labels,
      datasets:[
        {label:'EUR/USD', data:fiatHistory.EURUSD, borderColor:'blue', fill:false},
        {label:'EUR/GBP', data:fiatHistory.EURGBP, borderColor:'green', fill:false},
        {label:'EUR/JPY', data:fiatHistory.EURJPY, borderColor:'red', fill:false}
      ]
    },
    options:{responsive:true, plugins:{legend:{position:'top'}}}
  });
}

// Initial load
updateDashboard();
// Refresh every interval
setInterval(updateDashboard, interval);
</script>

</body>
</html>
